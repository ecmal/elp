{
  "version": 3,
  "file": "run.js",
  "sourceRoot": "/Users/Sergey/Work/GH/ecmal/elp/src",
  "sources": [
    "run.ts"
  ],
  "names": [],
  "mappings": ";;QAOM,OAAO,EACP,EAAE,EAEF,UAAU;IAsBhB;QACI,sBAAW,SAAE;iBAAb;gBACI,EAAE,CAAA,CAAC,OAAO,IAAI,CAAC,WAAW,CAAC,IAAE,WAAW,CAAC,CAAA,CAAC;oBACtC,IAAI,CAAC;wBACD,IAAI,CAAC,WAAW,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,CAAC;oBAC1D,CAAC;oBAAA,KAAK,CAAA,CAAC,CAAC,CAAC,CAAA,CAAC;wBACN,IAAI,CAAC,WAAW,CAAC,GAAG,KAAK,CAAC;oBAC9B,CAAC;gBACL,CAAC;gBACD,MAAM,CAAC,IAAI,CAAC,WAAW,CAAC,CAAC;YAC7B,CAAC;;;WAAA;QAkBO,oBAAM,GAAd,UAAe,IAAW,EAAC,IAAW,EAAC,MAAa;YAChD,IAAI,OAAO,GAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAClC,EAAE,CAAA,CAAC,CAAC,OAAO,CAAC,CAAA,CAAC;gBACT,IAAI,OAAO,GAAG,eAAU,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,EAAC,IAAI,GAAC,SAAS,CAAC,CAAC;gBACxE,EAAE,CAAA,CAAC,eAAU,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC,CAAA,CAAC;oBAC3B,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,EAAE,CAAC,iBAAiB,CAChD,IAAI,CAAC,KAAK,CAAC,eAAU,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAC3C,CAAC;oBACF,IAAI,GAAG,GAAO,OAAO,CAAC,mBAAmB,CAAC,EAAC,MAAA,IAAI,EAAC,QAAA,MAAM,EAAC,CAAC,CAAC;oBACzD,MAAM,CAAI,GAAG,CAAC,MAAM,SAAI,GAAG,CAAC,IAAI,SAAI,GAAG,CAAC,MAAQ,CAAC;gBACrD,CAAC;YACL,CAAC;YACD,MAAM,CAAI,IAAI,SAAI,IAAI,SAAI,MAAQ,CAAC;QAEvC,CAAC;QAED,sBAAY,uBAAM;iBAAlB;gBACI,EAAE,CAAA,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAA,CAAC;oBACZ,IAAI,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,wBAAwB,EAAE,MAAM,CAAC,CAAC;oBAChF,IAAI,CAAC,IAAI,CAAC,GAAG,IAAI,MAAM,CAAC,QAAQ,GAAC,2CAA2C,EAAC,GAAG,CAAC,CAAC;gBACtF,CAAC;gBACD,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACtB,CAAC;;;WAAA;QACD,oBAAM,GAAN,UAAO,CAAC;YACJ,EAAE,CAAA,CAAC,GAAG,CAAC,EAAE,CAAC,CAAA,CAAC;gBACP,IAAI,KAAK,GAAG,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACjC,EAAE,CAAA,CAAC,KAAK,CAAC,CAAA,CAAC;oBACN,MAAM,CAAC,CAAC,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,EAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,EAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,EAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;gBAC1F,CAAC;YACL,CAAC;YACD,MAAM,CAAC,CAAC,CAAC;QACb,CAAC;QACD,qBAAO,GAAP;YAAA,iBAkCC;YAlCO,cAAO;iBAAP,WAAO,CAAP,sBAAO,CAAP,IAAO;gBAAP,6BAAO;;YAEX,IAAI,OAAO,GAAW,IAAI,CAAC,OAAO,GAAG,iBAAO,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAC5D,IAAI,OAAO,GAAG,eAAU,CAAC,OAAO,CAAC,OAAO,CAAC,SAAS,EAAI,OAAO,CAAC,IAAI,QAAK,CAAC,CAAC;YACzE,eAAU,CAAC,SAAS,CAAC,OAAO,EAAC,UAAU,CAAC,IAAI,EAAE,CAAC,OAAO,CAAC,QAAQ,EAAC,IAAI,CAAC,IAAI,GAAI,OAAO,CAAC,IAAI,SAAI,IAAI,CAAC,IAAM,GAAC,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC;YACxH,IAAI,KAAK,GAAG,EAAE,CAAC,IAAI,CAAC,OAAO,EAAC,IAAI,EAAM;gBAClC,GAAG,EAAO,OAAO,CAAC,SAAS;gBAC3B,MAAM,EAAI,IAAI;aACjB,CAAC,CAAC;YACH,IAAI,QAAQ,GAAG,IAAI,CAAC;YACpB,IAAI,QAAQ,GAAG,IAAI,CAAC;YACpB,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,EAAC,UAAC,IAAI;gBACxB,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,UAAC,CAAC,EAAC,CAAC;oBACrD,EAAE,CAAA,CAAC,QAAQ,IAAI,CAAC,GAAC,CAAC,CAAC,CAAA,CAAC;wBAChB,QAAQ,GAAG,KAAK,CAAC;wBACjB,MAAM,CAAC,WAAS,KAAI,CAAC,MAAM,CAAC,CAAC,CAAG,CAAC;oBACrC,CAAC;oBAAA,IAAI,CAAA,CAAC;wBACF,MAAM,CAAC,KAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;oBAC1B,CAAC;gBACL,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YACnB,CAAC,CAAC,CAAC;YACH,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,EAAE,UAAC,IAAI;gBACzB,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,UAAC,CAAC,EAAC,CAAC;oBACrD,EAAE,CAAA,CAAC,QAAQ,IAAI,CAAC,GAAC,CAAC,CAAC,CAAA,CAAC;wBAChB,QAAQ,GAAG,KAAK,CAAC;wBACjB,MAAM,CAAC,WAAS,KAAI,CAAC,MAAM,CAAC,CAAC,CAAG,CAAC;oBACrC,CAAC;oBAAA,IAAI,CAAA,CAAC;wBACF,MAAM,CAAC,KAAI,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;oBAC1B,CAAC;gBACL,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;YACnB,CAAC,CAAC,CAAC;YACH,KAAK,CAAC,EAAE,CAAC,OAAO,EAAE;gBAAC,cAAO;qBAAP,WAAO,CAAP,sBAAO,CAAP,IAAO;oBAAP,6BAAO;;gBACtB,OAAO,CAAC,IAAI,OAAZ,OAAO,GAAM,OAAO,SAAI,IAAI,EAAC,CAAA;YACjC,CAAC,CAAC,CAAC;QACP,CAAC;;;;;oDAlFD;gBAAA,CAAC,gBAAM,CAAC;oBACJ,KAAK,EAAM,GAAG;oBACd,KAAK,EAAM,6BAA6B;iBAC3C,CAAC;YAAA;mDAGF;gBAAA,CAAC,gBAAM,CAAC;oBACJ,KAAK,EAAM,GAAG;oBACd,IAAI,EAAO,UAAU;oBACrB,KAAK,EAAM,6BAA6B;iBAC3C,CAAC;YAAA;;;;;;;;;;;;;;;;;8DAnCN;gBAAA,CAAC,iBAAO,CAAC;oBACL,KAAK,EAAI,aAAa;oBACtB,IAAI,EAAK,QAAQ;oBACjB,KAAK,EAAI,CAAC,kMAQT,CAAC;iBACL,CAAC;YAAA;;QAiGF,UAAC;QAhGD;YAAyB,+BAAG;YAgBxB,UAAK,GAAS,KAAK,CAAC;YAOpB,SAAI,GAAS,KAAK,CAAC;YAGX,SAAI,GAAK,EAAE,CAAC;QAsExB,CAAC;IAAD,CAAC,AAhGD,IAgGC;;IAhGD,yBAgGC,CAAA;;;;;;;;;;;;;;;YAzHK,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;YAC9B,EAAE,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;YAE1C,UAAU,GAAG,iJAMlB,CAAC;YAgBF,kBAAA,IAAyB,aAgGxB",
  "sourcesContent": [
    "import {Command} from './command';\nimport {Option} from './command';\nimport {Cli} from \"./command\";\n\nimport {Project} from \"../models/project\";\nimport {FileSystem} from \"../utils/fs\";\n\nconst process = system.node.process;\nconst CP = system.node.require('child_process');\n\nconst RUN_SCRIPT = `\nrequire('./runtime/package');\nSystem.import('§MAIN§').catch(function(e){\n    console.error(e.stack);\n    process.exit(1);\n});\n`;\n\n\n@Command({\n    title  : 'Run Project',\n    args   : '[path]',\n    usage  : [`\n    Usage :\n    |  elp compile [options] [path]\n    |\n    Examples :\n    |  elp compile\n    |  elp compile ./my-module\n    |  elp compile -o ./my/out/dir ./my-module/package.json\n    `]\n})\nexport class Run extends Cli {\n    static get SM():any{\n        if(typeof this['SourceMap']=='undefined'){\n            try {\n                this['SourceMap'] = system.node.require('source-map');\n            }catch(e){\n                this['SourceMap'] = false;\n            }\n        }\n        return this['SourceMap'];\n    }\n\n    @Option({\n        alias    : 'w',\n        title    : 'Watch files for compilation'\n    })\n    watch:boolean=false;\n\n    @Option({\n        alias    : 't',\n        args     : '<module>',\n        title    : 'Watch files for compilation'\n    })\n    test:boolean=false;\n\n    private project:Project;\n    private maps:any={};\n\n    private mapFor(path:string,line:number,column:number){\n        var mapJson:any = this.maps[path];\n        if(!mapJson){\n            var mapPath = FileSystem.resolve(this.project.vendorDir,path+'.js.map');\n            if(FileSystem.isFile(mapPath)){\n                mapJson = this.maps[path] = Run.SM.SourceMapConsumer(\n                    JSON.parse(FileSystem.readFile(mapPath))\n                );\n                var pos:any = mapJson.originalPositionFor({line,column});\n                return `${pos.source}:${pos.line}:${pos.column}`;\n            }\n        }\n        return `${path}:${line}:${column}`;\n\n    }\n\n    private get regexp():RegExp{\n        if(!this['rx']){\n            var basePath = this.project.vendorDir.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n            this['rx'] = new RegExp(basePath+'\\/([A-Z0-9\\\\/\\\\-_\\\\.]*)\\.js:(\\\\d+):(\\\\d+)','i');\n        }\n        return this['rx'];\n    }\n    format(l){\n        if(Run.SM){\n            var match = l.match(this.regexp);\n            if(match){\n                return l.replace(match[0],this.mapFor(match[1],parseInt(match[2]),parseInt(match[3])))\n            }\n        }\n        return l;\n    }\n    execute(...args){\n\n        var project:Project = this.project = Project.read(this.cwd);\n        var runFile = FileSystem.resolve(project.vendorDir,`${project.name}.js`);\n        FileSystem.writeFile(runFile,RUN_SCRIPT.trim().replace('§MAIN§',this.test?`${project.name}/${this.test}`:project.main));\n        var child = CP.fork(runFile,args,<any>{\n            cwd     : project.vendorDir,\n            silent  : true\n        });\n        var outFirst = true;\n        var errFirst = true;\n        child.stderr.on('data',(data)=>{\n            process.stderr.write(data.toString().split(/\\n/).map((l,i)=>{\n                if(errFirst || i>0){\n                    errFirst = false;\n                    return `err | ${this.format(l)}`;\n                }else{\n                    return this.format(l);\n                }\n            }).join('\\n'));\n        });\n        child.stdout.on('data', (data)=>{\n            process.stdout.write(data.toString().split(/\\n/).map((l,i)=>{\n                if(outFirst || i>0){\n                    outFirst = false;\n                    return `out | ${this.format(l)}`;\n                }else{\n                    return this.format(l);\n                }\n            }).join('\\n'));\n        });\n        child.on('close', (...args)=>{\n            console.info('close',...args)\n        });\n    }\n\n}\n"
  ]
}